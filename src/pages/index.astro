---
import BaseLayout from '../layouts/BaseLayout.astro';
import ThemeToggle from '../components/ThemeToggle.astro';
import Icon from '../components/Icon.astro';
---

<BaseLayout title="BTCHome - Bitcoin vs Real Estate Investment Comparison">

<!-- FIXED LAYOUT WITH PROPER MARGINS -->
<div>

  <!-- Header full-bleed, content constrained -->
  <header class="fixed top-0 left-0 right-0 z-50 bg-white/95 dark:bg-gray-950/95 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-800/50">
    <div class="container-pro">
      <div class="flex items-center justify-between h-16 md:h-20">
        <!-- Logo -->
        <div class="flex items-center space-x-3">
          <div class="w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-bitcoin-500 to-bitcoin-600 rounded-xl flex items-center justify-center shadow-lg">
            <Icon name="bitcoin" size="sm" class="md:size-md text-white" />
          </div>
          <span class="text-xl md:text-2xl font-light tracking-tight text-gray-900 dark:text-white">
            BTC<span class="font-semibold text-gradient-bitcoin">Home</span>
          </span>
        </div>

        <!-- Theme Toggle -->
        <ThemeToggle />
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="min-h-screen">
    <!-- Hero Section with Integrated Preview -->
    <section class="relative min-h-screen flex flex-col justify-center overflow-hidden pt-16 md:pt-20">
      <!-- Background Pattern -->
      <div class="absolute inset-0 bg-gradient-to-br from-white via-gray-50 to-blue-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-800"></div>
      <div class="absolute inset-0 opacity-20">
        <div class="absolute top-1/4 left-1/4 w-64 h-64 md:w-96 md:h-96 bg-bitcoin-500/10 rounded-full blur-3xl animate-pulse-slow"></div>
        <div class="absolute bottom-1/4 right-1/4 w-64 h-64 md:w-96 md:h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse-slow"></div>
      </div>

      <div class="relative z-10 container-pro text-center flex-1 flex flex-col justify-center">
          <!-- Main Headline -->
          <h1 class="text-3xl md:text-5xl lg:text-7xl font-extralight tracking-tight mb-6 md:mb-8">
            <span class="block text-gray-900 dark:text-white mb-2">How much house can</span>
            <span class="block text-gradient-bitcoin font-medium">₿ 1.5 Bitcoin</span>
            <span class="block text-gray-600 dark:text-gray-400 text-2xl md:text-3xl lg:text-5xl mt-2">
              buy you today?
            </span>
          </h1>

          <!-- Live Preview Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 max-w-4xl mx-auto mb-8 md:mb-12">
            <!-- Bitcoin Value -->
            <div class="glass p-4 md:p-6 rounded-2xl border border-bitcoin-200/50 dark:border-bitcoin-800/50 hover-lift">
              <div class="flex items-center justify-center w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-bitcoin-500 to-bitcoin-600 rounded-xl mx-auto mb-3 md:mb-4">
                <Icon name="bitcoin" size="sm" class="md:size-md text-white" />
              </div>
              <div class="text-2xl md:text-3xl font-bold text-gradient-bitcoin mb-2" id="hero-btc-value">$100,500</div>
              <div class="text-gray-600 dark:text-gray-400 text-xs md:text-sm">Current Stack Value</div>
              <div class="text-green-500 text-xs mt-1">+2.3% today</div>
            </div>

            <!-- House Affordability -->
            <div class="glass p-4 md:p-6 rounded-2xl border border-green-200/50 dark:border-green-800/50 hover-lift">
              <div class="flex items-center justify-center w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl mx-auto mb-3 md:mb-4">
                <Icon name="home" size="sm" class="md:size-md text-white" />
              </div>
              <div class="text-2xl md:text-3xl font-bold text-green-600 dark:text-green-400 mb-2">$420K</div>
              <div class="text-gray-600 dark:text-gray-400 text-xs md:text-sm">Max Home Price</div>
              <div class="text-blue-500 text-xs mt-1">20% down payment</div>
            </div>

            <!-- Opportunity Cost -->
            <div class="glass p-4 md:p-6 rounded-2xl border border-purple-200/50 dark:border-purple-800/50 hover-lift">
              <div class="flex items-center justify-center w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl mx-auto mb-3 md:mb-4">
                <Icon name="trending" size="sm" class="md:size-md text-white" />
              </div>
              <div class="text-2xl md:text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2">$1.2M</div>
              <div class="text-gray-600 dark:text-gray-400 text-xs md:text-sm">10-Year BTC Projection</div>
              <div class="text-orange-500 text-xs mt-1">Power Law Model</div>
            </div>
          </div>

          <!-- Interactive Input Preview -->
          <div class="content-narrow mb-6 md:mb-8">
            <div class="glass p-4 md:p-6 rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Your Bitcoin Amount
              </label>
              <div class="relative">
                <input
                  type="number"
                  id="hero-btc-input"
                  class="w-full px-4 py-3 text-xl md:text-2xl font-mono text-center bg-white/50 dark:bg-gray-800/50 border border-gray-300/50 dark:border-gray-600/50 rounded-xl focus:ring-2 focus:ring-bitcoin-500 focus:border-transparent transition-all"
                  placeholder="1.5"
                  step="0.00000001"
                  value="1.5"
                />
                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-bitcoin-500 font-semibold text-lg md:text-xl">
                  ₿
                </div>
              </div>
            </div>
          </div>

          <!-- Seamless Transition Button -->
          <div class="mb-6 md:mb-8">
            <button
              id="explore-scenarios-btn"
              class="group relative px-6 md:px-8 py-3 md:py-4 bg-gradient-to-r from-bitcoin-500 to-bitcoin-600 text-white rounded-2xl font-medium text-base md:text-lg shadow-xl hover:shadow-2xl transition-all duration-500 hover:-translate-y-1 hover:scale-105"
            >
              <span class="relative z-10 flex items-center space-x-2">
                <span>Explore All Scenarios</span>
                <Icon name="chevronDown" size="sm" class="group-hover:translate-y-1 transition-transform" />
              </span>
              <div class="absolute inset-0 bg-gradient-to-r from-bitcoin-600 to-bitcoin-700 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            </button>
          </div>
        </div>
      </div>

      <!-- Smooth Transition Indicator -->
      <div class="relative z-10 text-center pb-6 md:pb-8">
        <div class="inline-flex items-center space-x-2 text-gray-500 dark:text-gray-400 text-sm">
          <div class="w-2 h-2 bg-bitcoin-500 rounded-full animate-pulse"></div>
          <span>Live calculator below</span>
          <div class="w-2 h-2 bg-bitcoin-500 rounded-full animate-pulse"></div>
        </div>
      </div>
    </section>



    <!-- THE CORNERSTONE APP - Interactive Bitcoin vs Real Estate Calculator -->
    <section id="btc-home-calculator" class="relative bg-gradient-to-b from-blue-50 via-white to-gray-50 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900">

      <!-- Mobile-First Sticky Controls Panel -->
      <div class="sticky top-16 md:top-20 z-40 bg-white/95 dark:bg-gray-950/95 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-800/50 shadow-lg shadow-gray-200/20 dark:shadow-gray-900/20">
        <div class="container-pro py-3 md:py-4">

          <!-- Mobile Layout (Stacked) -->
          <div class="block md:hidden space-y-3">
            <!-- Bitcoin Input Row -->
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-2">
                <Icon name="bitcoin" size="sm" class="text-bitcoin-500" />
                <span class="text-sm font-semibold text-gray-900 dark:text-white">Stack:</span>
              </div>
              <div class="flex items-center space-x-2">
                <div class="relative">
                  <input
                    type="number"
                    id="btc-amount-main-mobile"
                    class="w-24 px-3 py-2 text-lg font-mono text-center bg-white dark:bg-gray-800 border-2 border-bitcoin-300 dark:border-bitcoin-700 rounded-lg focus:ring-2 focus:ring-bitcoin-500 focus:border-bitcoin-500 transition-all"
                    placeholder="1.5"
                    step="0.00000001"
                    value="1.5"
                  />
                  <div class="absolute -right-6 top-1/2 transform -translate-y-1/2 text-bitcoin-500 font-bold text-sm">₿</div>
                </div>
                <div class="text-right">
                  <div id="btc-value-display-mobile" class="text-lg font-bold text-gradient-bitcoin">$100,500</div>
                </div>
              </div>
            </div>

            <!-- Controls Row -->
            <div class="flex items-center justify-between">
              <select id="projection-model-mobile" class="flex-1 mr-2 px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-bitcoin-500 transition-all">
                <option value="power-law">Power Law</option>
                <option value="stock-to-flow">Stock-to-Flow</option>
                <option value="rainbow-chart">Rainbow Chart</option>
                <option value="halving-cycle">Halving Cycles</option>
                <option value="plan-b-s2fx">S2FX</option>
                <option value="metcalfe">Metcalfe</option>
                <option value="logarithmic">Log Growth</option>
                <option value="conservative">Conservative</option>
              </select>

              <select id="location-main-mobile" class="flex-1 ml-2 px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 transition-all">
                <option value="national">National</option>
                <option value="california">California</option>
                <option value="texas">Texas</option>
                <option value="florida">Florida</option>
                <option value="new-york">New York</option>
                <option value="washington">Washington</option>
              </select>
            </div>

            <!-- Quick Actions Row -->
            <div class="flex items-center justify-center space-x-2">
              <button class="px-3 py-1 text-sm bg-bitcoin-100 dark:bg-bitcoin-900 text-bitcoin-700 dark:text-bitcoin-300 rounded-lg hover:bg-bitcoin-200 dark:hover:bg-bitcoin-800 transition-colors" data-btc="0.1">
                ₿0.1
              </button>
              <button class="px-3 py-1 text-sm bg-bitcoin-100 dark:bg-bitcoin-900 text-bitcoin-700 dark:text-bitcoin-300 rounded-lg hover:bg-bitcoin-200 dark:hover:bg-bitcoin-800 transition-colors" data-btc="1">
                ₿1
              </button>
              <button class="px-3 py-1 text-sm bg-bitcoin-100 dark:bg-bitcoin-900 text-bitcoin-700 dark:text-bitcoin-300 rounded-lg hover:bg-bitcoin-200 dark:hover:bg-bitcoin-800 transition-colors" data-btc="5">
                ₿5
              </button>
              <button class="px-3 py-1 text-sm bg-bitcoin-100 dark:bg-bitcoin-900 text-bitcoin-700 dark:text-bitcoin-300 rounded-lg hover:bg-bitcoin-200 dark:hover:bg-bitcoin-800 transition-colors" data-btc="10">
                ₿10
              </button>
            </div>
          </div>

          <!-- Desktop Layout (Horizontal) -->
          <div class="hidden md:flex items-center justify-between gap-6">

            <!-- Bitcoin Input (Prominent) -->
            <div class="flex items-center space-x-4">
              <div class="flex items-center space-x-2">
                <Icon name="bitcoin" size="md" class="text-bitcoin-500" />
                <span class="font-semibold text-gray-900 dark:text-white">Your Stack:</span>
              </div>
              <div class="relative">
                <input
                  type="number"
                  id="btc-amount-main"
                  class="w-32 px-4 py-2 text-xl font-mono text-center bg-white dark:bg-gray-800 border-2 border-bitcoin-300 dark:border-bitcoin-700 rounded-xl focus:ring-2 focus:ring-bitcoin-500 focus:border-bitcoin-500 transition-all shadow-lg"
                  placeholder="1.5"
                  step="0.00000001"
                  value="1.5"
                />
                <div class="absolute -right-8 top-1/2 transform -translate-y-1/2 text-bitcoin-500 font-bold text-lg">₿</div>
              </div>
              <div class="text-right">
                <div id="btc-value-display" class="text-2xl font-bold text-gradient-bitcoin">$100,500</div>
                <div class="text-xs text-gray-500">@ $67,000/BTC</div>
              </div>
            </div>

            <!-- Model Selector -->
            <div class="flex items-center space-x-3">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap">Model:</span>
              <div class="flex items-center space-x-2">
                <select id="projection-model" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-bitcoin-500 transition-all shadow-md">
                  <option value="power-law">Power Law (Santostasi)</option>
                  <option value="stock-to-flow">Stock-to-Flow (PlanB)</option>
                  <option value="rainbow-chart">Rainbow Chart</option>
                  <option value="halving-cycle">Halving Cycles</option>
                  <option value="plan-b-s2fx">S2FX Cross-Asset</option>
                  <option value="metcalfe">Metcalfe's Law</option>
                  <option value="logarithmic">Log Growth</option>
                  <option value="conservative">Conservative</option>
                </select>
                <button id="model-info-btn" class="p-2 text-gray-500 hover:text-bitcoin-500 transition-colors" title="Model Information" data-tooltip="Open details about each projection model, assumptions, and sources.">
                  <Icon name="info" size="sm" />
                </button>
              </div>
            </div>

            <!-- Location Selector -->
            <div class="flex items-center space-x-3">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap">Market:</span>
              <select id="location-main" class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 transition-all shadow-md">
                <option value="national">National Average</option>
                <option value="california">California</option>
                <option value="texas">Texas</option>
                <option value="florida">Florida</option>
                <option value="new-york">New York</option>
                <option value="washington">Washington</option>
                <option value="colorado">Colorado</option>
                <option value="arizona">Arizona</option>
              </select>
            </div>

            <!-- Quick Actions -->
            <div class="flex items-center space-x-2">
              <button class="px-3 py-1 text-sm bg-bitcoin-100 dark:bg-bitcoin-900 text-bitcoin-700 dark:text-bitcoin-300 rounded-lg hover:bg-bitcoin-200 dark:hover:bg-bitcoin-800 transition-colors" data-btc="0.1">
                ₿0.1
              </button>
              <button class="px-3 py-1 text-sm bg-bitcoin-100 dark:bg-bitcoin-900 text-bitcoin-700 dark:text-bitcoin-300 rounded-lg hover:bg-bitcoin-200 dark:hover:bg-bitcoin-800 transition-colors" data-btc="1">
                ₿1
              </button>
              <button class="px-3 py-1 text-sm bg-bitcoin-100 dark:bg-bitcoin-900 text-bitcoin-700 dark:text-bitcoin-300 rounded-lg hover:bg-bitcoin-200 dark:hover:bg-bitcoin-800 transition-colors" data-btc="5">
                ₿5
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="container-pro section-padding">
        <!-- CENTERPIECE: Interactive Graph -->
        <div class="mb-8 md:mb-12">
          <div class="glass rounded-2xl md:rounded-3xl p-4 md:p-8 border border-gray-200/50 dark:border-gray-700/50 shadow-2xl">

            <!-- Graph Header -->
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-6 space-y-4 md:space-y-0">
              <div>
                <div class="flex items-center space-x-2 mb-2">
                  <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">
                    Bitcoin vs Real Estate Projection
                  </h2>
                  <button class="p-1 text-gray-500 hover:text-bitcoin-500 transition-colors" title="How projections work" data-tooltip="Chart displays BTC vs real estate value over time with your settings.">
                    <Icon name="info" size="sm" />
                  </button>
                </div>
                <p class="text-sm md:text-base text-gray-600 dark:text-gray-400">
                  Interactive timeline showing your wealth in different scenarios
                </p>
              </div>

              <!-- Time Range Selector -->
              <div class="flex bg-gray-100 dark:bg-gray-800 rounded-xl p-1 self-start md:self-auto">
                <button class="px-3 md:px-4 py-2 text-sm font-medium rounded-lg transition-all" data-timeframe="5">5Y</button>
                <button class="px-3 md:px-4 py-2 text-sm font-medium rounded-lg bg-bitcoin-500 text-white transition-all" data-timeframe="10">10Y</button>
                <button class="px-3 md:px-4 py-2 text-sm font-medium rounded-lg transition-all" data-timeframe="20">20Y</button>
                <button class="px-3 md:px-4 py-2 text-sm font-medium rounded-lg transition-all" data-timeframe="30">30Y</button>
              </div>
            </div>

            <!-- The Main Interactive Chart -->
            <div class="relative h-64 md:h-96 mb-4 md:mb-6">
              <canvas id="main-projection-chart" class="w-full h-full"></canvas>

              <!-- Chart Overlay Info -->
              <div id="chart-tooltip" class="absolute hidden bg-white dark:bg-gray-800 p-3 md:p-4 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 pointer-events-none z-10">
                <div class="text-sm font-semibold text-gray-900 dark:text-white mb-2" id="tooltip-date"></div>
                <div class="space-y-1" id="tooltip-values"></div>
              </div>
            </div>

            <!-- Interactive Legend with Live Values -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
              <div class="flex items-center justify-between p-3 md:p-4 bg-bitcoin-50 dark:bg-bitcoin-900/20 rounded-xl border border-bitcoin-200 dark:border-bitcoin-800">
                <div class="flex items-center space-x-2 md:space-x-3">
                  <div class="w-3 h-3 md:w-4 md:h-4 bg-bitcoin-500 rounded"></div>
                  <span class="text-sm md:text-base font-medium text-bitcoin-700 dark:text-bitcoin-300">Hold Bitcoin</span>
                </div>
                <div class="text-right">
                  <div id="bitcoin-final-value" class="value-fit currency-compact text-lg md:text-xl font-bold text-bitcoin-600 dark:text-bitcoin-400">$1.2M</div>
                  <div class="text-xs text-gray-500">10-year target</div>
                </div>
              </div>

              <div class="flex items-center justify-between p-3 md:p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-800">
                <div class="flex items-center space-x-2 md:space-x-3">
                  <div class="w-3 h-3 md:w-4 md:h-4 bg-green-500 rounded"></div>
                  <span class="text-sm md:text-base font-medium text-green-700 dark:text-green-300">Buy House</span>
                </div>
                <div class="text-right">
                  <div id="house-final-value" class="value-fit currency-compact text-lg md:text-xl font-bold text-green-600 dark:text-green-400">$680K</div>
                  <div class="text-xs text-gray-500">Home equity</div>
                </div>
              </div>

              <div class="flex items-center justify-between p-3 md:p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                <div class="flex items-center space-x-2 md:space-x-3">
                  <div class="w-3 h-3 md:w-4 md:h-4 bg-blue-500 rounded"></div>
                  <span class="text-sm md:text-base font-medium text-blue-700 dark:text-blue-300">Rent + Bitcoin</span>
                </div>
                <div class="text-right">
                  <div id="rent-bitcoin-final-value" class="value-fit currency-compact text-lg md:text-xl font-bold text-blue-600 dark:text-blue-400">$950K</div>
                  <div class="text-xs text-gray-500">Net worth</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- UNIQUE FEATURES: Advanced Analysis Panels -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8 mb-8 md:mb-12">

          <!-- Real-Time Affordability Calculator -->
          <div class="glass rounded-2xl p-4 md:p-6 border border-gray-200/50 dark:border-gray-700/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-6 space-y-2 md:space-y-0">
              <div class="flex items-center space-x-2">
                <h3 class="text-lg md:text-xl font-bold text-gray-900 dark:text-white flex items-center">
                  <Icon name="home" size="sm" class="md:size-md mr-2 md:mr-3 text-green-500" />
                  Housing Affordability Matrix
                </h3>
                <button class="p-1 text-gray-500 hover:text-green-500 transition-colors" title="How affordability is calculated" data-tooltip="Uses your income, down payment, rate, taxes, insurance and DTI assumptions.">
                  <Icon name="info" size="sm" />
                </button>
              </div>
              <div class="text-sm text-green-600 dark:text-green-400 font-medium">Live Updates</div>
            </div>

            <!-- Dynamic Affordability Grid -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="p-4 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl border border-green-200 dark:border-green-800">
                <div class="text-2xl font-bold text-green-600 dark:text-green-400 mb-1" id="max-home-price">$420K</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Max Home Price</div>
                <div class="text-xs text-green-500 mt-1">20% down</div>
              </div>

              <div class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl border border-blue-200 dark:border-blue-800">
                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1" id="down-payment-amount">$84K</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Down Payment</div>
                <div class="text-xs text-blue-500 mt-1">From Bitcoin</div>
              </div>

              <div class="p-4 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl border border-purple-200 dark:border-purple-800">
                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400 mb-1" id="remaining-bitcoin">$16.5K</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Bitcoin Left</div>
                <div class="text-xs text-purple-500 mt-1">Emergency fund</div>
              </div>

              <div class="p-4 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl border border-orange-200 dark:border-orange-800">
                <div class="text-2xl font-bold text-orange-600 dark:text-orange-400 mb-1" id="monthly-payment">$2,890</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Monthly Payment</div>
                <div class="text-xs text-orange-500 mt-1">PITI + HOA</div>
              </div>
            </div>

            <!-- Affordability Slider -->
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Down Payment %</span>
                <span id="down-payment-percent" class="text-sm font-bold text-bitcoin-600">20%</span>
              </div>
              <input
                type="range"
                id="down-payment-slider"
                min="5"
                max="50"
                value="20"
                class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
              />
              <div class="flex justify-between text-xs text-gray-500">
                <span>5%</span>
                <span>25%</span>
                <span>50%</span>
              </div>
            </div>
          </div>

          <!-- Bitcoin Projection Models Comparison -->
          <div class="glass rounded-2xl p-6 border border-gray-200/50 dark:border-gray-700/50">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center">
                <Icon name="trending" size="md" class="mr-3 text-bitcoin-500" />
                Model Predictions
              </h3>
              <div class="text-sm text-bitcoin-600 dark:text-bitcoin-400 font-medium">10-Year Targets</div>
            </div>

            <!-- Model Comparison Grid -->
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-bitcoin-50 to-orange-50 dark:from-bitcoin-900/20 dark:to-orange-900/20 rounded-lg border border-bitcoin-200 dark:border-bitcoin-800">
                <div>
                  <div class="font-semibold text-bitcoin-700 dark:text-bitcoin-300">Power Law</div>
                  <div class="text-xs text-gray-500">Mathematical trend</div>
                </div>
                <div class="text-right">
                  <div class="text-lg font-bold text-bitcoin-600 dark:text-bitcoin-400">$1.2M</div>
                  <div class="text-xs text-green-500">+1,095%</div>
                </div>
              </div>

              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                <div>
                  <div class="font-semibold text-yellow-700 dark:text-yellow-300">Stock-to-Flow</div>
                  <div class="text-xs text-gray-500">Scarcity model</div>
                </div>
                <div class="text-right">
                  <div class="text-lg font-bold text-yellow-600 dark:text-yellow-400">$850K</div>
                  <div class="text-xs text-green-500">+746%</div>
                </div>
              </div>

              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
                <div>
                  <div class="font-semibold text-purple-700 dark:text-purple-300">Rainbow Chart</div>
                  <div class="text-xs text-gray-500">Logarithmic bands</div>
                </div>
                <div class="text-right">
                  <div class="text-lg font-bold text-purple-600 dark:text-purple-400">$680K</div>
                  <div class="text-xs text-green-500">+577%</div>
                </div>
              </div>

              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <div>
                  <div class="font-semibold text-blue-700 dark:text-blue-300">Halving Cycles</div>
                  <div class="text-xs text-gray-500">4-year pattern</div>
                </div>
                <div class="text-right">
                  <div class="text-lg font-bold text-blue-600 dark:text-blue-400">$750K</div>
                  <div class="text-xs text-green-500">+647%</div>
                </div>
              </div>

              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                <div>
                  <div class="font-semibold text-gray-700 dark:text-gray-300">Conservative</div>
                  <div class="text-xs text-gray-500">Traditional assets</div>
                </div>
                <div class="text-right">
                  <div class="text-lg font-bold text-gray-600 dark:text-gray-400">$180K</div>
                  <div class="text-xs text-green-500">+79%</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- UNIQUE FEATURE: Bitcoin Stack Tracker -->
        <div class="glass rounded-2xl p-6 md:p-8 border border-gray-200/50 dark:border-gray-700/50 mb-8 md:mb-12">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
              <h3 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">
                Bitcoin Stack <span class="text-gradient-bitcoin">Growth Tracker</span>
              </h3>
              <button class="p-1 text-gray-500 hover:text-bitcoin-500 transition-colors" title="Track your Bitcoin's purchasing power over time" data-tooltip="Compares stacking BTC vs buying now; shows opportunity cost dynamics.">
                <Icon name="info" size="sm" />
              </button>
            </div>
            <div class="text-sm text-bitcoin-600 dark:text-bitcoin-400 font-medium">Live Tracking</div>
          </div>

          <!-- Real-time Stack Value -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="text-center p-4 bg-bitcoin-50 dark:bg-bitcoin-900/20 rounded-xl border border-bitcoin-200 dark:border-bitcoin-800">
              <div class="value-fit text-2xl font-bold text-bitcoin-600 dark:text-bitcoin-400 mb-1" id="stack-current-value">$100,500</div>
              <div class="text-xs text-gray-600 dark:text-gray-400">Current Value</div>
            </div>
            <div class="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-800">
              <div class="value-fit text-2xl font-bold text-green-600 dark:text-green-400 mb-1" id="stack-24h-change">+$2,340</div>
              <div class="text-xs text-gray-600 dark:text-gray-400">24h Change</div>
            </div>
            <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
              <div class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1" id="stack-houses-affordable">2.4</div>
              <div class="text-xs text-gray-600 dark:text-gray-400">Houses Affordable</div>
            </div>
            <div class="text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-800">
              <div class="text-2xl font-bold text-purple-600 dark:text-purple-400 mb-1" id="stack-years-to-million">3.2</div>
              <div class="text-xs text-gray-600 dark:text-gray-400">Years to $1M</div>
            </div>
          </div>
        </div>

        <!-- UNIQUE FEATURE: Opportunity Cost Timeline -->
        <div class="glass rounded-2xl p-6 md:p-8 border border-gray-200/50 dark:border-gray-700/50 mb-8 md:mb-12">
          <div class="text-center mb-6 md:mb-8">
            <div class="flex items-center justify-center space-x-2 mb-3">
              <h3 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">
                The <span class="text-gradient-bitcoin">Million Dollar</span> Question
              </h3>
              <button class="p-1 text-gray-500 hover:text-bitcoin-500 transition-colors" title="When could your Bitcoin buy different tier homes" data-tooltip="Estimates when your stack can afford home tiers under chosen model.">
                <Icon name="info" size="sm" />
              </button>
            </div>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
              See exactly when your Bitcoin stack could buy different tier homes, and what you'd miss by buying today
            </p>
          </div>

          <!-- Interactive Timeline -->
          <div class="relative">
            <!-- Timeline Track -->
            <div class="absolute left-0 right-0 top-1/2 h-1 bg-gradient-to-r from-bitcoin-200 via-bitcoin-400 to-bitcoin-600 rounded-full"></div>

            <!-- Timeline Points -->
            <div class="relative flex justify-between items-center py-8">
              <div class="text-center">
                <div class="w-4 h-4 bg-bitcoin-500 rounded-full mx-auto mb-3 shadow-lg"></div>
                <div class="bg-white dark:bg-gray-800 p-3 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                  <div class="font-bold text-bitcoin-600 dark:text-bitcoin-400">Today</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">$420K home</div>
                  <div class="text-xs text-gray-500">Starter home</div>
                </div>
              </div>

              <div class="text-center">
                <div class="w-4 h-4 bg-green-500 rounded-full mx-auto mb-3 shadow-lg"></div>
                <div class="bg-white dark:bg-gray-800 p-3 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                  <div class="font-bold text-green-600 dark:text-green-400">2027</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">$850K home</div>
                  <div class="text-xs text-gray-500">Family home</div>
                </div>
              </div>

              <div class="text-center">
                <div class="w-4 h-4 bg-blue-500 rounded-full mx-auto mb-3 shadow-lg"></div>
                <div class="bg-white dark:bg-gray-800 p-3 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                  <div class="font-bold text-blue-600 dark:text-blue-400">2030</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">$1.5M home</div>
                  <div class="text-xs text-gray-500">Luxury home</div>
                </div>
              </div>

              <div class="text-center">
                <div class="w-4 h-4 bg-purple-500 rounded-full mx-auto mb-3 shadow-lg"></div>
                <div class="bg-white dark:bg-gray-800 p-3 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                  <div class="font-bold text-purple-600 dark:text-purple-400">2034</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">$3M+ home</div>
                  <div class="text-xs text-gray-500">Dream home</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Disclaimer Section -->
    <section class="section-padding bg-gradient-to-r from-gray-50 via-blue-50 to-gray-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900">
      <div class="container-pro">
        <div class="max-w-4xl mx-auto text-center">
          <div class="flex items-center justify-center mb-6">
            <Icon name="info" size="lg" class="text-bitcoin-500 mr-3" />
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Important Disclaimer</h3>
          </div>
          <p class="text-gray-600 dark:text-gray-400 leading-relaxed">
            This tool provides educational analysis and should not be considered financial advice.
            Bitcoin and real estate investments carry significant risks. Past performance does not guarantee future results.
            Always consult with qualified financial professionals before making investment decisions.
          </p>
        </div>
      </div>
    </section>
  </main>

  <!-- Advanced Bitcoin Housing Calculator with Projection Models -->
  <script>
    // Advanced Bitcoin Housing Calculator
    class AdvancedBTCCalculator {
      constructor() {
        this.btcPrice = 67000;
        this.btc24hChange = 2.3;
        this.medianHomePrice = 420000;
        this.currentBtcAmount = 1.5;
        this.currentModel = 'power-law';
        this.currentTimeframe = 10;
        this.currentLocation = 'national';
        this.chart = null;

        // Research-based Bitcoin projection models with real formulas
        this.models = {
          'power-law': {
            name: 'Power Law (Santostasi)',
            formula: (years) => {
              // Giovanni Santostasi's Power Law: Price = A * (days since genesis)^n
              const genesisDate = new Date('2009-01-03');
              const currentDays = (Date.now() - genesisDate.getTime()) / (1000 * 60 * 60 * 24);
              const futureDays = currentDays + (years * 365.25);
              const A = 0.0001; // Coefficient
              const n = 5.8; // Power law exponent
              return A * Math.pow(futureDays, n);
            },
            color: '#ed7611',
            description: 'Mathematical power law relationship based on network growth',
            info: 'Based on Giovanni Santostasi\'s research showing Bitcoin follows a power law similar to natural phenomena like city growth.'
          },
          'stock-to-flow': {
            name: 'Stock-to-Flow (PlanB)',
            formula: (years) => {
              // PlanB's S2F model: ln(Price) = 3.3 * ln(S2F) - 14.6
              const currentS2F = 56; // Current stock-to-flow ratio
              const halvingYears = [2012, 2016, 2020, 2024, 2028, 2032];
              let s2f = currentS2F;

              // Adjust S2F for future halvings
              for (const halvingYear of halvingYears) {
                if (2024 + years >= halvingYear && halvingYear > 2024) {
                  s2f *= 2; // Double S2F ratio after each halving
                }
              }

              return Math.exp(3.3 * Math.log(s2f) - 14.6);
            },
            color: '#f59e0b',
            description: 'Scarcity model based on supply reduction from halvings',
            info: 'PlanB\'s model correlating Bitcoin price with its stock-to-flow ratio, measuring scarcity relative to annual production.'
          },
          'rainbow-chart': {
            name: 'Rainbow Chart',
            formula: (years) => {
              // Logarithmic regression: 10^(2.90 * log10(days) - 17.01)
              const genesisDate = new Date('2009-01-03');
              const currentDays = (Date.now() - genesisDate.getTime()) / (1000 * 60 * 60 * 24);
              const futureDays = currentDays + (years * 365.25);
              return Math.pow(10, 2.90 * Math.log10(futureDays) - 17.01);
            },
            color: '#8b5cf6',
            description: 'Logarithmic regression with confidence bands',
            info: 'Uses logarithmic regression to create price bands, with different colors representing market sentiment zones.'
          },
          'halving-cycle': {
            name: 'Halving Cycle Model',
            formula: (years) => {
              // 4-year cycle model with diminishing returns
              const cyclePosition = (years % 4) / 4; // Position in 4-year cycle
              const cycleNumber = Math.floor(years / 4) + 1;
              const baseGrowth = Math.pow(1.6, years) * this.btcPrice / this.btcPrice; // Diminishing returns
              const cyclicMultiplier = 1 + 0.8 * Math.sin(cyclePosition * 2 * Math.PI - Math.PI/2);
              return this.btcPrice * baseGrowth * cyclicMultiplier * Math.pow(0.8, cycleNumber);
            },
            color: '#3b82f6',
            description: '4-year cycle pattern with diminishing returns',
            info: 'Models Bitcoin\'s historical 4-year cycles driven by halvings, with each cycle showing diminishing percentage gains.'
          },
          'logarithmic': {
            name: 'Log Growth Curve',
            formula: (years) => {
              // Conservative logarithmic growth
              return this.btcPrice * Math.pow(Math.E, 0.5 * years) * Math.pow(years + 1, -0.1);
            },
            color: '#06b6d4',
            description: 'Conservative logarithmic growth trend',
            info: 'Conservative model assuming Bitcoin\'s growth rate slows over time as the market matures.'
          },
          'plan-b-s2fx': {
            name: 'S2FX Cross-Asset',
            formula: (years) => {
              // PlanB's S2FX model comparing Bitcoin to other store of value assets
              const marketCap = 1.3e12; // Current market cap
              const targetMarketCap = marketCap * Math.pow(10, years * 0.3); // Exponential growth
              return targetMarketCap / 19.7e6; // Divide by max supply
            },
            color: '#f97316',
            description: 'Cross-asset model comparing to gold and real estate',
            info: 'PlanB\'s enhanced model treating Bitcoin as a store of value asset class alongside gold and real estate.'
          },
          'metcalfe': {
            name: 'Metcalfe\'s Law',
            formula: (years) => {
              // Network value proportional to square of users
              const currentUsers = 100e6; // Estimated current users
              const userGrowth = Math.pow(1.2, years); // 20% annual user growth
              const futureUsers = currentUsers * userGrowth;
              const networkValue = Math.pow(futureUsers / currentUsers, 2);
              return this.btcPrice * networkValue * Math.pow(0.9, years); // Diminishing returns
            },
            color: '#10b981',
            description: 'Network effect model based on user adoption',
            info: 'Values Bitcoin based on Metcalfe\'s Law: network value grows with the square of connected users.'
          },
          'conservative': {
            name: 'Conservative Growth',
            formula: (years) => {
              // Traditional asset-like growth
              return this.btcPrice * Math.pow(1.08, years); // 8% annual growth
            },
            color: '#6b7280',
            description: 'Traditional asset growth rate (8% annually)',
            info: 'Conservative estimate assuming Bitcoin matures into a traditional store of value with stock market-like returns.'
          }
        };

        this.locationMultipliers = {
          'national': { price: 1.0, name: 'National Average' },
          'california': { price: 2.2, name: 'California' },
          'texas': { price: 0.85, name: 'Texas' },
          'florida': { price: 1.1, name: 'Florida' },
          'new-york': { price: 2.0, name: 'New York' },
          'washington': { price: 1.6, name: 'Washington' },
          'colorado': { price: 1.3, name: 'Colorado' },
          'arizona': { price: 0.95, name: 'Arizona' }
        };

        this.init();
      }

      init() {
        this.bindEvents();
        this.updateHeroPreview();
        this.updateCalculations();
        this.initChart();
        this.setupScrollBehavior();
      }

      bindEvents() {
        // Hero input synchronization with mobile and desktop inputs
        const heroInput = document.getElementById('hero-btc-input');
        const mainInput = document.getElementById('btc-amount-main');
        const mobileInput = document.getElementById('btc-amount-main-mobile');

        [heroInput, mainInput, mobileInput].forEach(input => {
          input?.addEventListener('input', (e) => {
            const value = e.target.value;
            this.currentBtcAmount = parseFloat(value) || 0;

            // Sync all inputs
            [heroInput, mainInput, mobileInput].forEach(syncInput => {
              if (syncInput && syncInput !== e.target) {
                syncInput.value = value;
              }
            });

            this.updateHeroPreview();
            this.updateCalculations();
            this.updateChart();
          });
        });

        // Model selector (both desktop and mobile)
        const modelSelect = document.getElementById('projection-model');
        const modelSelectMobile = document.getElementById('projection-model-mobile');

        [modelSelect, modelSelectMobile].forEach(select => {
          select?.addEventListener('change', (e) => {
            this.currentModel = e.target.value;

            // Sync both selectors
            [modelSelect, modelSelectMobile].forEach(syncSelect => {
              if (syncSelect && syncSelect !== e.target) {
                syncSelect.value = e.target.value;
              }
            });

            this.updateCalculations();
            this.updateChart();
          });
        });

        // Location selector (both desktop and mobile)
        const locationSelect = document.getElementById('location-main');
        const locationSelectMobile = document.getElementById('location-main-mobile');

        [locationSelect, locationSelectMobile].forEach(select => {
          select?.addEventListener('change', (e) => {
            this.currentLocation = e.target.value;

            // Sync both selectors
            [locationSelect, locationSelectMobile].forEach(syncSelect => {
              if (syncSelect && syncSelect !== e.target) {
                syncSelect.value = e.target.value;
              }
            });

            this.updateCalculations();
          });
        });

        // Quick amount buttons
        document.querySelectorAll('[data-btc]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const amount = e.target.dataset.btc;
            this.currentBtcAmount = parseFloat(amount);

            // Update all inputs
            const heroInput = document.getElementById('hero-btc-input');
            const mainInput = document.getElementById('btc-amount-main');
            const mobileInput = document.getElementById('btc-amount-main-mobile');

            [heroInput, mainInput, mobileInput].forEach(input => {
              if (input) input.value = amount;
            });

            this.updateHeroPreview();
            this.updateCalculations();
            this.updateChart();
          });
        });

        // Timeframe buttons
        document.querySelectorAll('[data-timeframe]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            // Update button states
            document.querySelectorAll('[data-timeframe]').forEach(b => {
              b.classList.remove('bg-bitcoin-500', 'text-white');
              b.classList.add('text-gray-600', 'dark:text-gray-400');
            });
            e.target.classList.add('bg-bitcoin-500', 'text-white');
            e.target.classList.remove('text-gray-600', 'dark:text-gray-400');

            this.currentTimeframe = parseInt(e.target.dataset.timeframe);
            this.updateChart();
          });
        });

        // Down payment slider
        const slider = document.getElementById('down-payment-slider');
        slider?.addEventListener('input', (e) => {
          const percent = e.target.value;
          document.getElementById('down-payment-percent').textContent = percent + '%';
          this.updateCalculations();
        });

        // Model info modal
        const modelInfoBtn = document.getElementById('model-info-btn');
        const modal = document.getElementById('model-info-modal');
        const closeModal = document.getElementById('close-modal');

        modelInfoBtn?.addEventListener('click', () => {
          this.showModelInfo();
          modal?.classList.remove('hidden');
        });

        closeModal?.addEventListener('click', () => {
          modal?.classList.add('hidden');
        });

        modal?.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.add('hidden');
          }
        });
      }

      showModelInfo() {
        const content = document.getElementById('model-info-content');
        if (!content) return;

        const modelEntries = Object.entries(this.models).map(([key, model]) => `
          <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
            <div class="flex items-center space-x-3 mb-3">
              <div class="w-4 h-4 rounded" style="background-color: ${model.color}"></div>
              <h4 class="font-semibold text-gray-900 dark:text-white">${model.name}</h4>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${model.description}</p>
            <p class="text-xs text-gray-500 dark:text-gray-500">${model.info}</p>
          </div>
        `).join('');

        content.innerHTML = modelEntries;
      }

      setupScrollBehavior() {
        const exploreBtn = document.getElementById('explore-scenarios-btn');
        const calculator = document.getElementById('btc-home-calculator');

        exploreBtn?.addEventListener('click', () => {
          calculator?.scrollIntoView({ behavior: 'smooth' });
        });
      }

      updateHeroPreview() {
        const btcValue = this.currentBtcAmount * this.btcPrice;
        const heroValueDisplay = document.getElementById('hero-btc-value');
        if (heroValueDisplay) {
          heroValueDisplay.textContent = this.formatCurrency(btcValue);
        }
      }

      updateCalculations() {
        const btcValue = this.currentBtcAmount * this.btcPrice;
        const locationData = this.locationMultipliers[this.currentLocation];
        const adjustedHomePrice = this.medianHomePrice * locationData.price;

        // Update both desktop and mobile displays
        const btcValueDisplay = document.getElementById('btc-value-display');
        const btcValueDisplayMobile = document.getElementById('btc-value-display-mobile');

        [btcValueDisplay, btcValueDisplayMobile].forEach(display => {
          if (display) {
            display.textContent = this.formatCurrency(btcValue);
          }
        });

        // Calculate housing affordability
        this.calculateHousingAffordability(btcValue, adjustedHomePrice);

        // Update model predictions
        this.updateModelPredictions(btcValue);

        // Update stack tracker
        this.updateStackTracker(btcValue, adjustedHomePrice);
      }

      updateStackTracker(btcValue, homePrice) {
        // Update current value
        this.updateElement('stack-current-value', this.formatCurrency(btcValue));

        // Calculate 24h change using real data
        const change24h = btcValue * (this.btc24hChange / 100);
        const changeSign = change24h >= 0 ? '+' : '';
        this.updateElement('stack-24h-change', `${changeSign}${this.formatCurrency(change24h)}`);

        // Calculate houses affordable (based on 20% down payment)
        const downPayment = homePrice * 0.2;
        const housesAffordable = btcValue / downPayment;
        this.updateElement('stack-houses-affordable', housesAffordable.toFixed(1));

        // Calculate years to $1M using current model
        const selectedModel = this.models[this.currentModel];
        let yearsToMillion = 0;
        for (let year = 1; year <= 20; year++) {
          const futurePrice = selectedModel.formula(year);
          const futureValue = this.currentBtcAmount * futurePrice;
          if (futureValue >= 1000000) {
            yearsToMillion = year;
            break;
          }
        }
        this.updateElement('stack-years-to-million', yearsToMillion > 0 ? yearsToMillion.toFixed(1) : '20+');
      }

      calculateHousingAffordability(btcValue, homePrice) {
        const downPaymentSlider = document.getElementById('down-payment-slider');
        const downPaymentPercent = (downPaymentSlider?.value || 20) / 100;

        const maxHomePrice = btcValue / downPaymentPercent;
        const actualHomePrice = Math.min(maxHomePrice, homePrice * 2); // Cap at 2x median
        const downPayment = actualHomePrice * downPaymentPercent;
        const bitcoinLeft = btcValue - downPayment;
        const monthlyPayment = this.calculateMortgagePayment(actualHomePrice - downPayment, 0.07, 30);

        // Update affordability display
        this.updateElement('max-home-price', this.formatCurrency(actualHomePrice));
        this.updateElement('down-payment-amount', this.formatCurrency(downPayment));
        this.updateElement('remaining-bitcoin', this.formatCurrency(Math.max(0, bitcoinLeft)));
        this.updateElement('monthly-payment', this.formatCurrency(monthlyPayment));
      }

      updateModelPredictions(currentBtcValue) {
        const models = ['power-law', 'stock-to-flow', 'rainbow-chart', 'halving-cycle'];
        const predictions = models.map(modelKey => {
          const model = this.models[modelKey];
          const futurePrice = model.formula(this.currentTimeframe);
          const futureValue = this.currentBtcAmount * futurePrice;
          const roi = ((futureValue - currentBtcValue) / currentBtcValue) * 100;
          return { modelKey, futureValue, roi };
        });

        // Update the model prediction displays
        predictions.forEach(({ modelKey, futureValue, roi }, index) => {
          const elements = document.querySelectorAll('.bg-gradient-to-r');
          if (elements[index]) {
            const valueElement = elements[index].querySelector('.text-lg.font-bold');
            const roiElement = elements[index].querySelector('.text-xs.text-green-500');
            if (valueElement) valueElement.textContent = this.formatCurrency(futureValue);
            if (roiElement) roiElement.textContent = `+${roi.toFixed(0)}%`;
          }
        });

        // Update chart legend values
        const selectedModel = this.models[this.currentModel];
        const bitcoinFinalValue = this.currentBtcAmount * selectedModel.formula(this.currentTimeframe);
        this.updateElement('bitcoin-final-value', this.formatCurrency(bitcoinFinalValue));

        // Estimate house and rent scenarios
        const houseEquity = currentBtcValue * 0.8 * Math.pow(1.03, this.currentTimeframe); // 3% appreciation
        const rentBitcoinValue = currentBtcValue * 0.2 * selectedModel.formula(this.currentTimeframe) / this.btcPrice;

        this.updateElement('house-final-value', this.formatCurrency(houseEquity));
        this.updateElement('rent-bitcoin-final-value', this.formatCurrency(rentBitcoinValue));
      }

      calculateMortgagePayment(principal, rate, years) {
        if (principal <= 0) return 0;
        const monthlyRate = rate / 12;
        const numPayments = years * 12;
        return principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) /
               (Math.pow(1 + monthlyRate, numPayments) - 1);
      }

      updateElement(id, value) {
        const element = document.getElementById(id);
        if (element) element.textContent = value;
      }

      initChart() {
        const ctx = document.getElementById('main-projection-chart');
        if (!ctx) {
          console.error('Chart canvas not found');
          return;
        }

        try {
          this.chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              {
                label: 'Hold Bitcoin',
                data: [],
                borderColor: '#ed7611',
                backgroundColor: 'rgba(237, 118, 17, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: false,
                pointRadius: 0,
                pointHoverRadius: 8,
              },
              {
                label: 'Buy House (Equity)',
                data: [],
                borderColor: '#22c55e',
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: false,
                pointRadius: 0,
                pointHoverRadius: 8,
              },
              {
                label: 'Rent + Keep Bitcoin',
                data: [],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: false,
                pointRadius: 0,
                pointHoverRadius: 8,
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              mode: 'index',
              intersect: false,
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: 'rgba(255, 255, 255, 0.95)',
                titleColor: '#1f2937',
                bodyColor: '#374151',
                borderColor: '#d1d5db',
                borderWidth: 1,
                cornerRadius: 12,
                displayColors: true,
                callbacks: {
                  title: function(context) {
                    return `Year ${context[0].label}`;
                  },
                  label: function(context) {
                    const value = context.parsed.y;
                    return `${context.dataset.label}: ${new Intl.NumberFormat('en-US', {
                      style: 'currency',
                      currency: 'USD',
                      minimumFractionDigits: 0,
                      maximumFractionDigits: 0,
                    }).format(value)}`;
                  }
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Years',
                  font: { size: 14, weight: 'bold' }
                },
                grid: {
                  color: 'rgba(156, 163, 175, 0.2)'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Value (USD)',
                  font: { size: 14, weight: 'bold' }
                },
                grid: {
                  color: 'rgba(156, 163, 175, 0.2)'
                },
                ticks: {
                  callback: function(value) {
                    if (value >= 1000000) {
                      return '$' + (value / 1000000).toFixed(1) + 'M';
                    } else if (value >= 1000) {
                      return '$' + (value / 1000).toFixed(0) + 'K';
                    }
                    return '$' + value.toLocaleString();
                  }
                }
              }
            },
            onHover: (event, activeElements) => {
              event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
            }
          }
        });

        this.updateChart();
        console.log('Chart initialized successfully');
        } catch (error) {
          console.error('Failed to initialize chart:', error);
        }
      }

      updateChart() {
        if (!this.chart) return;

        const years = Array.from({ length: this.currentTimeframe + 1 }, (_, i) => i);
        const selectedModel = this.models[this.currentModel];

        // Generate data for each scenario
        const bitcoinData = years.map(year => {
          const futurePrice = selectedModel.formula(year);
          return this.currentBtcAmount * futurePrice;
        });

        const houseData = years.map(year => {
          const initialEquity = this.currentBtcAmount * this.btcPrice * 0.2; // 20% down
          const appreciation = Math.pow(1.03, year); // 3% annual appreciation
          const principalPaydown = year * 5000; // Rough principal paydown
          return initialEquity * appreciation + principalPaydown;
        });

        const rentBitcoinData = years.map(year => {
          const rentCost = year * 30000; // $2,500/month rent
          const remainingBitcoin = this.currentBtcAmount * 0.8; // Keep 80% of Bitcoin
          const futurePrice = selectedModel.formula(year);
          const bitcoinValue = remainingBitcoin * futurePrice;
          return Math.max(0, bitcoinValue - rentCost);
        });

        // Update chart data
        this.chart.data.labels = years;
        this.chart.data.datasets[0].data = bitcoinData;
        this.chart.data.datasets[1].data = houseData;
        this.chart.data.datasets[2].data = rentBitcoinData;

        this.chart.update('none'); // Smooth update without animation
      }

      // Formats large numbers responsively: $1.2K / $3.4M / $5.6B / $7.8T
      formatCurrency(amount) {
        const abs = Math.abs(amount);
        const sign = amount < 0 ? '-' : '';
        const toUSD = (n) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(n);
        if (abs >= 1e12) return sign + '$' + (abs/1e12).toFixed(2) + 'T';
        if (abs >= 1e9)  return sign + '$' + (abs/1e9 ).toFixed(2) + 'B';
        if (abs >= 1e6)  return sign + '$' + (abs/1e6 ).toFixed(2) + 'M';
        if (abs >= 1e3)  return sign + '$' + (abs/1e3 ).toFixed(2) + 'K';
        return toUSD(abs).replace('$', sign + '$');
      }

      // Fetch real Bitcoin price (optional enhancement)
      async fetchBitcoinPrice() {
        try {
          const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
          const data = await response.json();
          this.btcPrice = data.bitcoin.usd;
          this.btc24hChange = data.bitcoin.usd_24h_change || 2.3;
          this.updateHeroPreview();
          this.updateCalculations();
          console.log('Bitcoin price updated:', this.btcPrice);
        } catch (error) {
          console.log('Using fallback Bitcoin price:', error);
          this.btc24hChange = 2.3; // Fallback change
        }
      }
    }

    // Enhanced initialization with better UX

      // Lightweight tooltip handler for all [data-tooltip]
      document.body.addEventListener('mouseenter', (e) => {
        const target = e.target.closest('[data-tooltip]');
        if (!target) return;
        let bubble = target.querySelector(':scope > .tooltip-bubble');
        if (!bubble) {
          bubble = document.createElement('div');
          bubble.className = 'tooltip-bubble';
          bubble.textContent = target.getAttribute('data-tooltip') || '';
          target.style.position = target.style.position || 'relative';
          target.appendChild(bubble);
        }
        bubble.style.display = 'block';
        const rect = target.getBoundingClientRect();
        bubble.style.left = '50%';
        bubble.style.transform = 'translateX(-50%)';
        bubble.style.top = `${target.offsetHeight + 8}px`;
      }, true);

      document.body.addEventListener('mouseleave', (e) => {
        const target = e.target.closest('[data-tooltip]');
        if (!target) return;
        const bubble = target.querySelector(':scope > .tooltip-bubble');
        if (bubble) bubble.style.display = 'none';
      }, true);

    document.addEventListener('DOMContentLoaded', () => {
      // Add loading state
      const loadingOverlay = document.createElement('div');
      loadingOverlay.className = 'fixed inset-0 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm z-50 flex items-center justify-center';
      loadingOverlay.innerHTML = `
        <div class="text-center">
          <div class="w-12 h-12 border-4 border-bitcoin-200 border-t-bitcoin-500 rounded-full animate-spin mx-auto mb-4"></div>
          <div class="text-gray-600 dark:text-gray-400">Loading calculator...</div>
        </div>
      `;
      document.body.appendChild(loadingOverlay);

      // Check if Chart.js is already loaded
      if (typeof Chart !== 'undefined') {
        initializeApp();
      } else {
        // Load Chart.js and initialize
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
        script.onload = initializeApp;
        script.onerror = () => {
          console.error('Failed to load Chart.js');
          loadingOverlay.innerHTML = `
            <div class="text-center">
              <div class="text-red-500 mb-4">Failed to load chart library</div>
              <button onclick="location.reload()" class="px-4 py-2 bg-bitcoin-500 text-white rounded-lg">Retry</button>
            </div>
          `;
        };
        document.head.appendChild(script);
      }

      function initializeApp() {
        try {
          // Initialize calculator
          const calculator = new AdvancedBTCCalculator();

          // Fetch real Bitcoin price
          calculator.fetchBitcoinPrice();

          // Remove loading overlay
          setTimeout(() => {
            loadingOverlay.remove();
          }, 500);
        } catch (error) {
          console.error('Failed to initialize app:', error);
          loadingOverlay.innerHTML = `
            <div class="text-center">
              <div class="text-red-500 mb-4">Failed to initialize calculator</div>
              <button onclick="location.reload()" class="px-4 py-2 bg-bitcoin-500 text-white rounded-lg">Retry</button>
            </div>
          `;
        }
      }

      // Add smooth scroll behavior for all internal links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
          }
        });
      });

      // Add intersection observer for animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-fade-in');
          }
        });
      }, observerOptions);

      // Observe all cards and major sections
      document.querySelectorAll('.card, .glass').forEach(el => {
        observer.observe(el);
      });
    });
  </script>

  <!-- Model Information Modal -->
  <div id="model-info-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-900 rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">Bitcoin Projection Models</h3>
          <button id="close-modal" class="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
            ✕
          </button>
        </div>
      </div>
      <div class="p-6 space-y-6" id="model-info-content">
        <!-- Model information will be populated here -->
      </div>
    </div>
  </div>

</div> <!-- Close app-container -->

</BaseLayout>
